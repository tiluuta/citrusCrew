<html>
    <head>
        <meta charset="UTF-8">
        <link href="stylesheet.css" rel="stylesheet" type="text/css">
        <!-- FONTS -->
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400&display=swap" rel="stylesheet">
        <!-- ICONS -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"/>
    </head>
    <body style="background-color:black;">
        <div id="navbar">
            <span class="material-symbols-outlined icon">apps</span>
            <span class="material-symbols-outlined icon"><a href="orderform.html">shopping_cart</a></span>
            <span class="material-symbols-outlined icon"><a href="contact.html">contact_support</a></span>
        </div>
        <div id="outercontainer">
            <div class="row" style="justify-content:center;">
                <img src="ring_transparent.png" style="width:200px;">
                <div class="bigtitle" style="color:white;">Keyring.</div>
            </div>
            <br>

            <div id="orderform">
            <div class="box" style="text-align:left;">
                <h1>Cart</h1>
                <p>Change customization</p>
                <p>Increase/Decrease quantity</p>
                <p>Remove from cart</p>
            </div>

            <br>

            <div class="box" style="text-align:left;">
                <h1>Contact</h1>
                <form method="post" action="action.php">
                    <div class="row">
                        <input type="text" placeholder="First Name">
                        <input type="text" placeholder="Last Name">
                    </div>
                    <input type="text" placeholder="Valid Email Address" id="email" required="1">
                    <div class="error" id="validemail"></div>
                    <input type="text" placeholder="Phone Number (Optional)" id="phone">
                    <div class="error" id="validphone"></div>
                    

                    
                </form>
                <br>
                <h1>Shipping</h1>
                    <input type="text" style="width:100%;" placeholder="Address 1">
                    <input type="text" style="width:100%;" placeholder="Address 2 (Optional)">
                    <div class="row">
                        <input type="text" placeholder="City">
                        <input type="text" placeholder="State" id="state">
                        <input type="text" placeholder="ZIP Code" id="zip">
                    </div>
                    <br>
            </div>

            <br>

            <div class="box" style="text-align:left;">
                <h1>Order Summary</h1>
                <p id="tax">Tax: <em>Calculating...</em></p>
                <p>Shipping fee: $5</p>
                <p id="total">Total Calculation: <em>Calculating...</em></p>

                <div class="row" style="text-align:center;">
                    <div class="darkbutton" style="margin-top:50px;width:100px;" id="orderaction">Order Now</div>
                    <div class="roundbutton" style="margin-top:50px;width:80px;" id="cancelaction">Cancel</div>
                </div>
            </div>

            
            
        </div>

        <script>

            removespaces = function(input){
                input = input.replace(/ /g, "");
                return input;
            }
            function removecharacters(input){
                input = input.replace(/,/g, "");
                input = input.replace(/\./g,"");
                return input;
            }
            checkemail = function(input){
                let atposition = input.indexOf("@");
                if (atposition < 0 || input.indexOf(".",atposition) < 0){
                    document.querySelector("#validemail").innerHTML = "Please enter a valid email address with a domain.";
                } else
                document.querySelector("#validemail").innerHTML = "";
            }
            checkphone = function(input){
                let atposition = input.indexOf("(");
                if (atposition < 0 || input.indexOf(")",atposition) < 0 || input.indexOf("-") != 8){
                    document.querySelector("#validphone").innerHTML = "Please enter a phone number with the format (***)***-****.";
                } else
                document.querySelector("#validphone").innerHTML = "";
            }
            findtax = function(input){
                let zip = "";
                if(input.length == 5){
                    zip = input;   
                    
                    fetch(url,options)
                        .then((response) => {
                            return response.json();
                        })
                        .then((data) => {
                            console.log(data);
                            let taxhtml = '';

                            const taxrate = `${data.data.combined_rate}`;
                            taxhtml += taxrate;

                            let sum = 20.0;
                            document.getElementById("total").innerHTML = "Total Calculation: $" + totalcalc(sum,taxrate);


                            document.getElementById("tax").innerHTML = "Tax: " + taxhtml + "%";
                        })
                        .catch(err => console.error(err));

                }
            }

            totalcalc = function(sum,taxrate){
                let totalsum = sum * (parseFloat(taxrate) / 100);
                totalsum += sum;
                totalsum += 5.00;
                return totalsum;
            }



            /* SALES TAX */
            const url = 'https://sales-tax-rates1.p.rapidapi.com/v/api/?zip=' + document.querySelector("#zip").value;

            const options = {
                method: 'GET',
                headers: {
                    'content-type': 'application/octet-stream',
                    'X-RapidAPI-Key': 'a98364e0cemshaa9ebfb8ecbf8c5p19c9d2jsnc40ea2454627',
                    'X-RapidAPI-Host': 'sales-tax-rates1.p.rapidapi.com'
                }
            };
            
            document.querySelector("#email").addEventListener("keypress",function(){
                checkemail(document.querySelector("#email").value);
            })
            document.querySelector("#phone").addEventListener("keypress",function(){
                document.querySelector("#phone").value = removespaces(document.querySelector("#phone").value);
                checkphone(document.querySelector("#phone").value);
            })
            document.querySelector("#zip").addEventListener("input",function(){
                findtax(document.querySelector("#zip").value);
            })
            document.querySelector("#orderaction").addEventListener("click",function(){
                window.open("https://docs.google.com/forms/d/e/1FAIpQLSfBAURC1R2nr4Ki9X_wH7vC7TpOZgk_bHe21BEP2pKxlM1G9A/viewform"); 
            })
            document.querySelector("#cancelaction").addEventListener("click",function(){
                window.open("main.html", "_self"); 
            })

        </script>




        </div>
        <div id="footer">
            <div class="row" style="align-items:flex-start;gap:30%;">
            <div class="bigtitle">Keyring.</div>
            <div class="column" style="margin-top:50px;">
                <a href="main.html">Home.</a>
                <a href="team.html">About Us.</a>
                <a href="store.html">Store.</a>
                <a href="features.html">How to use.</a>
                <a href="learn.html">How it works.</a>
                <a href="usecases.html">Use cases.</a>
                <a href="contact.html">Contact us.</a>
            </div>
        </div>
        </div>


    </body>



</html>